---
import { LOCALES, useTranslations, type Lang } from "@/i18n";
import Layout from "@/layouts/Base.astro";
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import PageHeadline from "@/components/PageHeadline.astro";

const locale = Astro.currentLocale as Lang;
const t = useTranslations(locale);

const projects = (await getCollection("projects"))
    .filter((project) => project.id.split("/")[0] === locale)
    .sort((a, b) => a.data.date.valueOf() - b.data.date.valueOf());

const title = t({
    ja: "プロジェクト",
    en: "Projects",
    "zh-cn": "项目",
    ar: "مشاريع",
});

export const getStaticPaths = () =>
    Object.keys(LOCALES).map((lang) => ({
        params: { lang },
    }));
---

<Layout {title}>
    <PageHeadline {title} />

    <ul>
        {
            projects.map((project) => {
                const [, ...id] = project.id.split("/");
                return (
                    <li>
                        <a href={`/${locale}/projects/${id.join("/")}/`}>
                            {project.data.cover && (
                                <Image
                                    src={project.data.cover}
                                    alt={project.data.title}
                                />
                            )}
                            <h2>{project.data.title}</h2>
                        </a>
                    </li>
                );
            })
        }
    </ul>
</Layout>

<style>
    ul {
        margin-block-start: var(--sp-m);
        display: grid;
        gap: var(--sp-s);
        grid-template-columns: repeat(auto-fill, minmax(20rem, 1fr));
    }

    li {
        margin-block-end: 1rem;
        img {
            border-radius: 6px;
        }
    }
</style>
